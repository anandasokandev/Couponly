<c-row class="justify-content-center align-items-center mb-4">
    <c-col lg="12">
        <c-card>
            <c-card-header>
                <h2 class="h5 mb-0">Reset your password</h2>
            </c-card-header>
            
                <p class="text-medium-emphasis mt-4 ms-4">Enter a new password for your account.</p>

            <c-card-body class="mx-5 px-5">

                <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" novalidate>
                    <!-- <input type="hidden" formControlName="token" /> -->

                    <!-- Two-column layout for the form fields -->
                    <div class="row gx-4">
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label class="form-label" for="current">Current password</label>
                                <div class="mb-3 position-relative">
                                    <input
                                        id="current"
                                        [type]="showCurrent ? 'text' : 'password'"
                                        formControlName="currentPassword"
                                        placeholder="Enter current password"
                                        autocomplete="current-password"
                                        class="form-control form-control-sm"
                                    />
                                    <i
                                        class="top-0 position-absolute end-0 translate-middle-y me-3 mt-3 text-muted fa-solid"
                                        style="cursor:pointer;"
                                        [ngClass]="showCurrent ? 'fa-eye' : 'fa-eye-slash'"
                                        (click)="showCurrent = !showCurrent"
                                    ></i>
                                </div>

                                <div class="mt-1" *ngIf="resetForm.get('currentPassword')?.touched">
                                    <small class="text-danger" *ngIf="resetForm.get('currentPassword')?.hasError('required')">Current password is required.</small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label" for="password">New password</label>
                                <div class="mb-3 position-relative">
                                    <input
                                        id="password"
                                        [type]="showPassword ? 'text' : 'password'"
                                        formControlName="password"
                                        placeholder="Enter new password"
                                        autocomplete="new-password"
                                        class="form-control form-control-sm"
                                    />
                                    <i class="top-0 position-absolute end-0 translate-middle-y me-3 mt-3 text-muted fa-solid" style="cursor:pointer;" [ngClass]="showPassword ? 'fa-eye' : 'fa-eye-slash'" (click)="showPassword = !showPassword"></i>
                                </div>
                                
                                <div class="mt-2 px-2" *ngIf="resetForm.get('password')?.value">
                                    <div class="progress" style="height:6px;">
                                        <div
                                            class="progress-bar"
                                            [ngClass]="{
                                              'bg-danger': passwordStrength < 30,
                                              'bg-warning': passwordStrength >= 30 && passwordStrength < 70,
                                              'bg-success': passwordStrength >= 70
                                            }"
                                            role="progressbar"
                                            [style.width.%]="passwordStrength"
                                            aria-valuemin="0"
                                            aria-valuemax="100"
                                        ></div>
                                    </div>
                                    <small class="text-muted">{{ passwordStrengthLabel }}</small>
                                </div>

                                <div class="mt-1 d-flex flex-column" *ngIf="resetForm.get('password')?.touched">
                                    <small class="text-danger" *ngIf="resetForm.get('password')?.hasError('required')">Password is required.</small>
                                    <small class="text-danger" *ngIf="resetForm.get('password')?.hasError('minlength')">Password must be at least 8 characters.</small>
                                    <small class="text-danger" *ngIf="resetForm.get('password')?.hasError('pattern')">Password must contain at least one uppercase letter, one digit, and one special character.</small>
                                </div>

                            </div>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="mb-3 h-100 d-flex flex-column">
                                <label class="form-label" for="confirm">Confirm password</label>
                                <div class="position-relative mb-3">
                                    <input
                                        id="confirm"
                                        [type]="showConfirm ? 'text' : 'password'"
                                        formControlName="confirmPassword"
                                        placeholder="Confirm new password"
                                        autocomplete="new-password"
                                        class="form-control form-control-sm"
                                    />
                                    <i class="top-0 position-absolute end-0 translate-middle-y me-3 mt-3 text-muted fa-solid" style="cursor:pointer;" [ngClass]="showConfirm ? 'fa-eye' : 'fa-eye-slash'" (click)="showConfirm = !showConfirm"></i>
                                </div>

                                <div class="mt-1 d-flex flex-column" *ngIf="resetForm.get('confirmPassword')?.touched">
                                    <small class="text-danger" *ngIf="resetForm.get('confirmPassword')?.hasError('required')">Confirmation is required.</small>
                                    <small class="text-danger" *ngIf="resetForm.get('confirmPassword')?.hasError('minlength')">Password must be at least 8 characters.</small>
                                    <small class="text-danger" *ngIf="resetForm.hasError('mismatch')">Passwords do not match.</small>
                                    <small class="text-danger" *ngIf="resetForm.hasError('sameAsCurrent')">New password cannot be the same as the current password.</small>
                                    <small class="text-danger" *ngIf="resetForm.hasError('currentInvalid')">Current password is incorrect.</small>
                                    <!-- <small class="text-danger" -->
                                </div>

                                <!-- spacer to keep actions aligned near bottom on taller columns -->
                                <div class="mt-4">
                                    <div class="d-flex justify-content-end align-items-center gap-4">
                                        <button type="button" class="btn btn-sm btn-secondary" [routerLink]="'/store/store-info'">Back to profile</button>
                                        <button type="submit" class="btn btn-sm btn-primary" [disabled]="resetForm.invalid || submitting">
                                            {{ submitting ? 'Savingâ€¦' : 'Save new password' }}
                                        </button>
                                    </div>

                                    <div class="mt-3">
                                        <div class="text-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
                                        <div class="text-success" *ngIf="success">Password updated successfully. You can now sign in with your new password.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end two-column layout -->
                </form>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>
