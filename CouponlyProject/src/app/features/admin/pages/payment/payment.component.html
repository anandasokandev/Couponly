
<div *ngIf="!isPaid; else paymentDone">
  <div class="payment-wrapper">
    <div class="payment-card">
      <h2>Complete Your Payment</h2>
      <form [formGroup]="paymentForm">
        <div class="form-group">
          <label>Cardholder Name</label>
          <input formControlName="cardholderName" placeholder="e.g., Rahul Sharma" (keypress)="allowOnlyLetters($event)" />
          <span class="small-error" *ngIf="paymentForm.get('cardholderName')?.invalid && paymentForm.get('cardholderName')?.touched">
            * Please enter a valid name must start with uppercase
          </span>
        </div>

        <div class="form-group">
          <label>Card Number</label>
          <input formControlName="cardNumber" placeholder="XXXXXXXXXXXXXXXX" type="text"
            (keypress)="allowOnlyNumbers($event)" inputmode="numeric" maxlength="16" class="form-control" />
          <span class="small-error" *ngIf="paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched">
            * Card number must be 16 digits
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Expiry</label>
            <input formControlName="expiry" type="month" placeholder="MM/YYYY" />
            <span class="small-error" *ngIf="paymentForm.get('expiry')?.invalid && paymentForm.get('expiry')?.touched">
              * Expiry date is required
            </span>
          </div>

          <div class="form-group">
            <label>CVV</label>
            <input formControlName="cvv" maxlength="3" placeholder="CVV" />
            <span class="small-error" *ngIf="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched">
              * CVV must be 3 digits
            </span>
          </div>
        </div>

        <button type="button" class="pay-btn" (click)="startPayment()">Pay ₹ {{totalAmount}}</button>
      </form>
    </div>
  </div>

  <div class="loader-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <div class="actions">
      <button (click)="handleResult(true)">Success</button>
      <button (click)="handleResult(false)">Fail</button>
    </div>
  </div>

  <div class="result-popup" *ngIf="showResult">
    <div class="popup" [ngClass]="{ success: isSuccess, fail: !isSuccess }">
      <div class="icon" [ngClass]="{ success: isSuccess, fail: !isSuccess }">
        <span>{{ isSuccess ? '✓' : '✕' }}</span>
      </div>
      <h3>{{ isSuccess ? 'Payment Successful!' : 'Payment Failed' }}</h3>
      <p>
        {{ isSuccess ? 'Your transaction has been completed.' : 'Transaction could not be processed. Please try again.' }}
      </p>
      <button [ngClass]="{ fail: !isSuccess }" (click)="navigate()">Continue</button>
    </div>
  </div>
</div>

<!-- payment is already done -->
<ng-template #paymentDone>
  <div class="payment-wrapper">
    <div class="payment-card">
      <h2>Payment Already Completed</h2>
      <p>Your transaction has already been processed. No further action is required.</p>
    </div>
  </div>
</ng-template>
