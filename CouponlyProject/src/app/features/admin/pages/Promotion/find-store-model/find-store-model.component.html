

<c-modal
  #FindStoreModal
  [scrollable]="true"
  alignment="center"
  id="FindStoreModal"
  class="wide-modal"
>
    <c-modal-header>
        <h5 cModalTitle>Find and Add Store Contacts</h5>
        <button
            [cModalToggle]="FindStoreModal.id"
            class="btn-close"
            cButtonClose
            >
        </button>
    </c-modal-header>

    <c-modal-body class="p-4">
        <h6 class="mb-1">Choose Store</h6>
        <form [formGroup]="filterForm">
            <!-- <div class="d-flex gap-3 py-3">
                <select class="form-select form-select-sm" formControlName="district">
                    <option value=0 [selected]="districtId === 0">All Distircts</option>
                    <option *ngFor="let district of districts" [value]="district.id" [selected]="districtId === district.id">{{ district.districtName }}</option>
                </select>
                <select class="form-select form-select-sm" formControlName="location">
                    <option value=0 [selected]="locationId === 0">All Locations</option>
                    <option *ngFor="let location of locations" [value]="location.id" [selected]="locationId === location.id">{{ location.locationName }}</option>

                </select>
                <select class="form-select form-select-sm" formControlName="category">
                    <option value=0 [selected]="categoryId === 0">All Categories</option>
                    <option *ngFor="let category of categories" [value]="category.id" [selected]="categoryId === category.id">{{ category.name }}</option>
                </select>
            </div> -->
            <div class="d-flex gap-4">
                <c-input-group>
                    <span cInputGroupText>
                        <i class="fas fa-search"></i>
                    </span>
                    <input cFormControl class="form-control-sm" type="text" formControlName="storeName" placeholder="Search by name...">
                </c-input-group>
                <button cButton color="secondary" class="btn btn-sm d-flex align-items-center" (click)="searchStores()" [disabled]="!searchtext || isStoreLoading">
                    Search <i class="fas fa-search ms-2"></i></button>
            </div>
        </form>

    <hr>

    <h6>Search Results</h6>

    <div *ngIf="isStoreLoading" class="d-flex justify-content-center my-5">
        <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <ng-container *ngIf="searchResults && searchResults.length > 0 && !isStoreLoading">
        <table [hover]="true" cTable class="responsive-table">
            <thead>
            <tr>
                <th>#</th>
                <th>Logo</th>
                <th>Store Name</th>
                <th>available Contacts</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let store of searchResults; let i = index" class="align-middle">
                <td>{{ currentPage * itemsPerPage - itemsPerPage + i + 1 }}</td>
                <td><img [src]="store.storeLogo" class="img"></td>
                <td>{{store.store}}</td>
                <td></td>
                <td>
                <button cButton class="btn-sm" (click)="selectStore(store)" [disabled]="store === selectedStore">
                    <i class="fas fa-check"></i>
                </button>
                </td>
            </tr>
            <tr *ngIf="searchResults.length === 0">
                <td colspan="4">No stores found. Please adjust your filters.</td>
            </tr>
            </tbody>
        </table>

        <app-pagination 
            [currentPage]="currentPage"
            [itemsPerPage]="itemsPerPage"
            [totalItems]="totalItems"
            [fromModel]="true"
            (pageChange)="onPageChange($event)"
        ></app-pagination>
    </ng-container>

    <div class="mt-2" *ngIf="couponBox">
        <table [hover]="true" cTable class="responsive-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Logo</th>
                    <th>Store Name</th>
                    <th>available Contacts</th>
                </tr>
            </thead>
            <tbody>
                <tr class="align-middle">
                    <td>1</td>
                    <td><img [src]="selectedStore.storeLogo" class="img"></td>
                    <td>{{selectedStore.store}}</td>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <h6 class="mt-3">Choose Coupon details</h6>
        <div class="d-flex gap-4">
            <c-input-group>
                <span cInputGroupText>
                    <i class="fas fa-search"></i>
                </span>
                <input cFormControl class="form-control-sm" type="text" [(ngModel)]="couponText" placeholder="Search by name...">
            </c-input-group>
            <button cButton color="secondary" class="btn btn-sm d-flex align-items-center" (click)="searchCoupon()" [disabled]="!couponText || isCouponLoading">
                Search <i class="fas fa-search ms-2"></i>
            </button>
            <ng-container *ngIf="couponDetails">
                <div class="card p-2" style="width: 18rem;">
                    <img [src]="couponDetails.couponImage" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h6 class="card-title">{{ couponDetails.couponCode }}</h6>
                        <p class="card-text">{{ couponDetails.couponName }}</p>
                    </div>
                </div>
            </ng-container>
        </div>
        <div *ngIf="!couponDetails" class="mt-3">
            <p>No coupon details found. Please adjust your search.</p>
        </div>
        <div *ngIf="isCouponLoading" class="d-flex justify-content-center my-2">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div *ngIf="!isStoreLoading && !searchResults.length && !couponBox" class="mt-4">
        <div *ngIf="selectedStore" class="selection-area">
            <p>You have selected: <strong>{{ selectedStore.store }}</strong> ({{ selectedStore.totalContacts }} contacts available)</p>
            <p>Contacts available in public repo.: {{ selectedStore.totalContacts }}</p>
            <div class="d-flex gap-3">
                <label for="contactsNeeded">No.of contacts for promotion:</label>
                <input
                    type="number"
                    cFormControl
                    class="form-control-sm"
                    id="contactsNeeded"
                    [(ngModel)]="contactsNeeded"
                    [max]="selectedStore.totalContacts - selectedStore.contactsAlreadyAdded"
                    min="1"
                    style="width: 100px; text-align: right;"
                    >
                <span>/ {{ selectedStore.totalContacts }}</span>
            </div>
        </div>
        <p *ngIf="!selectedStore">No results found. Please adjust your filters.</p>
    </div>

    
    </c-modal-body>

    <c-modal-footer>
    <button cButton class="btn-sm" color="secondary" [cModalToggle]="FindStoreModal.id">Cancel</button>
    <button
        cButton
        type="button"
        class="btn-sm"
        color="primary"
        (click)="addContacts()"
        [disabled]="!selectedStore || !contactsNeeded || contactsNeeded <= 0"
        [cModalToggle]="FindStoreModal.id"
    >
        Select Store
    </button>
    </c-modal-footer>

</c-modal>