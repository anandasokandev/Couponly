<c-modal #addCouponModal [scrollable]="true" alignment="center" id="addCouponModal">
  <app-add-coupon-modal></app-add-coupon-modal>
</c-modal>


<c-col xs="12">
  <c-card class="mb-4">

    <!-- Header -->
    <c-card-header>
      <div class="d-flex justify-content-between align-items-center">
        <strong class="fs-5">Coupon List</strong>
        <button class="btn btn-primary btn-sm px-3 py-1 text-nowrap" [cModalToggle]="addCouponModal.id">
          Generate Coupon
        </button>
      </div>
    </c-card-header>

    <c-card-body>

      <!-- Tabs Just Below Header -->
      <div class="border-bottom mb-3">
        <ul class="nav nav-tabs">
          <li class="nav-item">

            <a class="nav-link" [ngClass]="{ active: activeTab === 'coupons' }" (click)="activeTab = 'coupons'"
              href="javascript:void(0)">
              Coupons
            </a>
          </li>
          <li class="nav-item">

            <a class="nav-link" [ngClass]="{ active: activeTab === 'storeWise' }" (click)="activeTab = 'storeWise'"
              href="javascript:void(0)">
              Store-Wise Coupons
            </a>
          </li>
        </ul>
      </div>

      <!--  Coupons Tab -->
      <ng-container *ngIf="activeTab === 'coupons'">
        <!-- ðŸ” Filters -->
        <div class="d-flex justify-content-start align-items-center mb-4 flex-wrap gap-2">
          <input type="text" class="form-control form-control-sm" style="max-width: 210px" [(ngModel)]="couponCode"
            placeholder="Search Coupon Code" (input)="filterCoupons()" />


          <input type="text" class="form-control form-control-sm" style="max-width: 210px" [(ngModel)]="storeNameSearch"
            placeholder="Search Store Name" (input)="filterCoupons()" />

          <select class="form-select form-select-sm" style="max-width: 210px" [(ngModel)]="selectedType"
            (change)="filterCoupons()">
            <option [ngValue]="undefined">-- Select Type --</option>
            <option *ngFor="let type of types" [ngValue]="type.id">{{ type.name }}</option>
          </select>

          <select class="form-select form-select-sm" style="max-width: 180px;" [(ngModel)]="selectedDateFilter"
            (change)="loadCoupons()">
            <option value="1">All Coupons</option>
            <option value="2">Valid Coupons</option>
            <option value="3">Upcoming Coupons</option>
            <option value="4">Expired Coupons</option>
          </select>



          <button type="button" class="btn btn-danger btn-sm text-white" title="Reset" (click)="resetFilters()">
            <i class="fas fa-arrows-rotate"></i>
          </button>
        </div>

        <!--  Loader / Empty -->
        <div *ngIf="isLoading" class="text-center">Loading...</div>
        <div *ngIf="!isLoading && coupons.length === 0" class="text-center">No coupons found.</div>

        <!--  Coupon List -->
<!--  Coupon List -->
<div *ngIf="!isLoading" class="d-flex flex-wrap gap-3 justify-content-start">
  <div *ngFor="let coupon of coupons; let i = index" class="coupon-card d-flex flex-column">

    <!-- Image -->
    <img *ngIf="coupon.couponImage" [src]="coupon.couponImage" alt="Coupon Image" class="coupon-image" />

    <!-- Card content -->
    <div class="coupon-content flex-grow-1">
      <h5 class="coupon-title" [style.color]="getColor(i)">{{ coupon.name }}</h5>
      <div class="coupon-code-box text-center">{{ coupon.couponCode }}</div>
      <p class="coupon-desc">{{ coupon.description }}</p>
      <div class="coupon-details mb-2">
        <p><span class="label">Store:</span> {{ coupon.storeName }}</p>
        <p><span class="label">Coupon Type:</span> {{ coupon.typeName }}</p>
        <p><span class="label">Min Amount:</span> {{ coupon.minAmount | currency:'INR' }}</p>
        <div class="user-limit-box">
          User Limit: {{ coupon.userLimit === false ? 'Unlimited' : coupon.userLimitCount }}
        </div>
      </div>
    </div>

    <!-- Footer with dates on one line and delete button -->
    <div class="coupon-footer d-flex justify-content-between align-items-center mt-3 pt-2 border-top">
      
      <!-- Dates with padding from left -->
      <div class="coupon-dates ps-2">
        <span><strong>Start:</strong> {{ coupon.startingDate | date:'dd-MM-yyyy' }}</span>
        <span class="ms-4"><strong>End:</strong> {{ coupon.endingDate | date:'dd-MM-yyyy' }}</span>
      </div>
      
      <div class="d-flex align-items-center pe-1">
  <button 
  type="button" 
  (click)="deleteCoupon(coupon.id)" 
  title="Delete" 
  class="btn p-0 bg-transparent border-0">
  <i class="fas fa-trash text-danger" style="font-size: 1rem;"></i>
</button>

  </div>
      
    </div>
    
  </div>
</div>


        <!--  Pagination -->
        <app-pagination *ngIf="!isLoading" [totalItems]="totalItems" [itemsPerPage]="itemsPerPage"
          [currentPage]="currentPage" (pageChange)="onPageChange($event)"
          (itemsPerPageChange)="onItemsPerPageChange($event)">
        </app-pagination>
      </ng-container>




      <!--  Store-Wise Tab -->
      <ng-container *ngIf="activeTab === 'storeWise'">
        <app-store-wise-coupon></app-store-wise-coupon>
      </ng-container>

    </c-card-body>
  </c-card>
</c-col>