<c-modal #DownloadRedeemsModal [scrollable]="true" alignment="center" id="DownloadRedeemsModal">
  <app-download-redeems-model></app-download-redeems-model>
</c-modal>

<c-col xs="12">
    <c-card class="mb-4">
        <c-card-header class="d-md-flex justify-content-md-between align-items-center">
            <strong class="w-100 fs-5">Redeem History</strong>
            <div class="d-grid gap-4 d-sm-flex justify-content-md-end w-100">
                
                <div class="">
                    <button class="btn btn-primary btn-sm px-3 py-1 text-nowrap d-flex align-items-center" data-bs-toggle="tooltip" title="Download History"  [cModalToggle]="DownloadRedeemsModal.id">
                        <!-- <svg cIcon name="cib-cloud-download" size="md"></svg> -->
                        <svg [cIcon]="icons.cilCloudDownload"></svg> &nbsp; Download
                    </button>
                    
                </div>
            </div>
        </c-card-header>
        <c-card-body>
            <!-- <div class="d-md-flex justify-content-md-end">
                <div class="d-flex gap-4 align-items-center m-3">
                    <strong class="w-md-50">Store: </strong>
                    <select class="form-control w-100" (change)="onStoreChange($event)">
                        <option value="">All</option>
                        <option value="Relience Thpzha">Relience Thpzha</option>
                        <option value="More Koothattkulam">More Koothattkulam</option>
                    </select>
                </div>
            </div> -->
            <form [formGroup]="filterForm">
                <div class="d-md-flex justify-content-start">
                    <div class="d-flex gap-4 align-items-center m-2">
                        <!-- <strong class="w-md-50">District: </strong> -->
                        <select class="form-select form-select-sm"  formControlName="district">
                            <option value=0>All Distircts</option>
                            <option *ngFor="let district of districts" [value]="district.id">{{ district.districtName }}</option>
                        </select>
                    </div>
                    <div class="d-flex gap-4 align-items-center m-2">
                        <!-- <strong class="w-md-50">Location: </strong> -->
                        <!-- <select class="form-control w-100" [(ngModel)]="selectedDistirctId"> -->
                        <select class="form-select form-select-sm" formControlName="location">
                            <option value=0>All Locations</option>                        
                            <!-- <option *ngFor="let location of getLocations(selectedDistirctId)">{{ location.locationName }}</option> -->
                            <option *ngFor="let location of getLocations()" [value]="location.id">{{ location.locationName }}</option>

                        </select>
                    </div>
                    <div class="input-container d-flex gap-1 align-items-center m-2">
                        <label for="fromDate" class="input-label">From:</label>
                        <input type="date" id="fromDate" class="form-control form-control-sm" formControlName="from" />
                    </div>
                    <div class="input-container d-flex gap-1 align-items-center m-2">
                        <label for="toDateDate" class="input-label">To:</label>
                        <input type="date" id="toDate" class="form-control form-control-sm" formControlName="to" />
                    </div>
                    <button class="btn btn-sm btn-danger text-white m-3" title="Reset" (click)="resetFilter()">
                        <i class="fas fa-arrows-rotate"></i>
                    </button>
                </div>
            </form>
            <table [hover]="true" cTable class="responsive-table">
                <thead>
                    
                    <tr class="">
                        <th scope="col" data-label="#"> </th>
                        <th scope="col" data-label="District Name">
                            Coupon Code
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Location Name">
                            Coupon Name
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Pincode">
                            User
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Latitude">
                            Store
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Latitude">
                            Location
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Longitude">
                            Redeem Date
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                    </tr>

                    <tr>
                        <th data-label="#"></th>
                        <th data-label="Coupon Code Filter">
                            <div class="d-flex align-items-center">
                                <input type="text" placeholder="Coupon Code" [(ngModel)]="filterCouponCode" class="form-control form-control-sm" />
                                
                            </div>
                        </th>
                        <th data-label="Coupon Name Filter">
                            <div class="d-flex align-items-center">
                                <input type="text" placeholder="Coupon Name" [(ngModel)]="filterCouponName" class="form-control form-control-sm" />
                                
                            </div>
                        </th>
                        <th data-label="User Filter">
                            <input type="text" placeholder="Filter Users" [(ngModel)]="filterUsers" class="form-control form-control-sm" />
                        </th>
                        <th data-label="Store Filter">
                            <input type="text" placeholder="Filter Stores" [(ngModel)]="filterStores" class="form-control form-control-sm" />
                        </th>
                        <th data-label="Location Filter">
                            <input type="text" placeholder="Filter Locations" [(ngModel)]="filterLocations" class="form-control form-control-sm" />
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    
                    <ng-container *ngIf="!isLoading">
                        <ng-container *ngFor="let red of getRedeemsFiltered() | filterstore: filterStores | filteruser: filterUsers | filtercouponname: filterCouponName | filtercouponcode: filterCouponCode; let i = index">
                            <tr>
                                <td data-label="#">{{ i+1 }}</td>
                                <td data-label="District Name">
                                    {{ red.redeemCouponCode }}
                                </td>
                                <td data-label="Location Name">{{ red.redeemCouponName }}</td>
                                <td data-label="Pincode">{{ red.user }}</td>
                                <td data-label="Latitude">{{ red.store }}</td>
                                <td data-label="Longitude">{{ red.location }}</td>
                                <td data-label="">{{ red.date | date: 'short' }}</td>
                            </tr>
                        </ng-container>
                    </ng-container>
                    
                </tbody>
            </table>
            <div *ngIf="isLoading" class="d-flex justify-content-center m-2">
                <c-spinner color="info" class="me-2" />Loading...
            </div>
            <div class="d-flex justify-content-center m-2" *ngIf="!isLoading && getRedeemsFiltered().length === 0">No data found!</div>
        </c-card-body>
    </c-card>
</c-col>