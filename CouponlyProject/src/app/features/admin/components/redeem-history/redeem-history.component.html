<c-modal #DownloadRedeemsModal [scrollable]="true" alignment="center" id="DownloadRedeemsModal">
  <app-download-redeems-model></app-download-redeems-model>
</c-modal>

<c-col xs="12">
    <c-card class="mb-4">
        <c-card-header class="d-flex align-items-center">
            <strong class="w-100 fs-5">Redeem History</strong>
            <div class="d-grid gap-4 d-sm-flex justify-content-md-end w-100">
                
                <div class="float-end">
                    <button 
                        class="btn btn-primary btn-sm px-3 py-1 text-nowrap d-flex align-items-center" 
                        data-bs-toggle="tooltip" 
                        title="Download History"  
                        [cModalToggle]="DownloadRedeemsModal.id"
                        [disabled]="isLoading">
                        <!-- <svg cIcon name="cib-cloud-download" size="md"></svg> -->
                        <svg [cIcon]="icons.cilCloudDownload"></svg> &nbsp; Download
                    </button>
                    
                </div>
            </div>
        </c-card-header>
        <c-card-body>
            <!-- <div class="d-md-flex justify-content-md-end">
                <div class="d-flex gap-4 align-items-center m-3">
                    <strong class="w-md-50">Store: </strong>
                    <select class="form-control w-100" (change)="onStoreChange($event)">
                        <option value="">All</option>
                        <option value="Relience Thpzha">Relience Thpzha</option>
                        <option value="More Koothattkulam">More Koothattkulam</option>
                    </select>
                </div>
            </div> -->
            <form [formGroup]="filterForm">
                <div class="d-flex flex-wrap justify-content-start py-3">
                    <div class="d-flex gap-4 align-items-center m-2">
                        <!-- <strong class="w-md-50">District: </strong> -->
                        <select cSelect class="form-select form-select-sm"  formControlName="district" [disabled]="isLoading">
                            <option value=0 [selected]="districtId === 0">All Distircts</option>
                            <option *ngFor="let district of districts" [value]="district.id" [selected]="districtId === district.id">{{ district.districtName }}</option>
                        </select>
                    </div>
                    <div class="d-flex gap-4 align-items-center m-2">
                        <!-- <strong class="w-md-50">Location: </strong> -->
                        <!-- <select class="form-control w-100" [(ngModel)]="selectedDistirctId"> -->
                        <select class="form-select form-select-sm" formControlName="location" [disabled]="isLoading">
                            <option value=0 [selected]="locationId === 0">All Locations</option>
                            <!-- <option *ngFor="let location of getLocations(selectedDistirctId)">{{ location.locationName }}</option> -->
                            <option *ngFor="let location of locations" [value]="location.id" [selected]="locationId === location.id">{{ location.locationName }}</option>

                        </select>
                    </div>
                    <div class="input-container d-flex gap-1 align-items-center m-2">
                        <label for="fromDate" class="input-label">From:</label>
                        <input type="date" id="fromDate" class="form-control form-control-sm" formControlName="from" [disabled]="isLoading" />
                    </div>
                    <div class="input-container d-flex gap-1 align-items-center m-1">
                        <label for="toDateDate" class="input-label">To:</label>
                        <input type="date" id="toDate" class="form-control form-control-sm" formControlName="to" [disabled]="isLoading" />
                    </div>
                    <button class="btn btn-sm btn-danger text-white m-2" title="Reset" (click)="resetFilter()" [disabled]="isLoading">
                        <i class="fas fa-arrows-rotate"></i>
                    </button>
                </div>
            </form>
            <div class="table-responsive">
            <table [hover]="true" cTable class="responsive-table">
                <thead>
                    
                    <tr class="">
                        <th scope="col" data-label="#"># </th>
                        <th scope="col" data-label="District Name">
                            Coupon Code
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Location Name">
                            Coupon Name
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Pincode">
                            User
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Latitude">
                            Store
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Latitude">
                            Location
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                        <th scope="col" data-label="Longitude">
                            Redeem Date
                            <svg [cIcon]="icons.cilSortAlphaUp"></svg>
                        </th>
                    </tr>

                    <tr>
                        <th data-label="#"></th>
                        <th data-label="Coupon Code Filter">
                            <div class="d-flex align-items-center">
                                <input type="text" placeholder="Coupon Code" [(ngModel)]="filterCouponCode" class="form-control form-control-sm" [disabled]="isLoading" />
                                
                            </div>
                        </th>
                        <th data-label="Coupon Name Filter">
                            <div class="d-flex align-items-center">
                                <input type="text" placeholder="Coupon Name" [(ngModel)]="filterCouponName" class="form-control form-control-sm" [disabled]="isLoading" />
                                
                            </div>
                        </th>
                        <th data-label="User Filter">
                            <input type="text" placeholder="Filter Users" [(ngModel)]="filterUsers" class="form-control form-control-sm" [disabled]="isLoading" />
                        </th>
                        <th data-label="Store Filter">
                            <input type="text" placeholder="Filter Stores" [(ngModel)]="filterStores" class="form-control form-control-sm" [disabled]="isLoading" />
                        </th>
                        <th data-label="Location Filter">
                            <input type="text" placeholder="Filter Locations" [(ngModel)]="filterLocations" class="form-control form-control-sm" [disabled]="locationId != 0 || isLoading" />
                        </th>
                        <th></th>
                    </tr>
                </thead>
                
                <tbody *ngIf="!isLoading">
                    <tr *ngFor="let red of getRedeemsFiltered() | filterstore: filterStores | filteruser: filterUsers | filtercouponname: filterCouponName | filtercouponcode: filterCouponCode; let i = index">
                        <td data-label="#">{{ (currentPage - 1) * itemsPerPage + (i + 1) }}</td>
                        <td data-label="District Name">
                            {{ red.redeemCouponCode }}
                        </td>
                        <td data-label="Location Name">{{ red.redeemCouponName }}</td>
                        <td data-label="Pincode">{{ red.user }}</td>
                        <td data-label="Latitude">{{ red.store }}</td>
                        <td data-label="Longitude">{{ red.location }}</td>
                        <td data-label="">{{ red.date | date: 'short' }}</td>
                    </tr>
                    <tr *ngIf="getRedeemsFiltered().length === 0">
                        <td colspan="7" class="text-center">No data found!</td>
                    </tr>
                </tbody>

                <tbody *ngIf="isLoading">
                    <tr cPlaceholderAnimation="glow" *ngFor="let i of [1, 2, 3, 4]">
                        <td ><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                        <td><span cPlaceholder cPlaceholderSize="sm" cCol="12"></span></td>
                    </tr>
                </tbody>

                <!-- <tfoot *ngIf="!isLoading">
                    <tr>
                        <td colspan="7">
                            <app-pagination 
                                [totalItems]=100 
                                [itemsPerPage]="itemsPerPage" 
                                [currentPage]="currentPage"
                                (pageChange)="onPageChange($event)">
                            </app-pagination>
                        </td>
                    </tr>
                </tfoot> -->
            </table>
            </div>
            <!-- <div *ngIf="isLoading" class="d-flex justify-content-center m-2">
                <c-spinner color="info" class="me-2" />Loading...
            </div> -->
            
            <app-pagination 
                *ngIf="!isLoading"
                [totalItems]="totalItems" 
                [itemsPerPage]="itemsPerPage" 
                [currentPage]="currentPage"
                (pageChange)="onPageChange($event)"
                (itemsPerPageChange)="itemsPerPage = $event; onPageChange(1)">
            </app-pagination>
            
        </c-card-body>
    </c-card>
</c-col>